class D{diff(e,n,t={}){let s;typeof t=="function"?(s=t,t={}):"callback"in t&&(s=t.callback);const a=this.castInput(e,t),u=this.castInput(n,t),d=this.removeEmpty(this.tokenize(a,t)),r=this.removeEmpty(this.tokenize(u,t));return this.diffWithOptionsObj(d,r,t,s)}diffWithOptionsObj(e,n,t,s){var a;const u=i=>{if(i=this.postProcess(i,t),s){setTimeout(function(){s(i)},0);return}else return i},d=n.length,r=e.length;let l=1,o=d+r;t.maxEditLength!=null&&(o=Math.min(o,t.maxEditLength));const h=(a=t.timeout)!==null&&a!==void 0?a:1/0,P=Date.now()+h,c=[{oldPos:-1,lastComponent:void 0}];let m=this.extractCommon(c[0],n,e,0,t);if(c[0].oldPos+1>=r&&m+1>=d)return u(this.buildValues(c[0].lastComponent,n,e));let g=-1/0,v=1/0;const L=()=>{for(let i=Math.max(g,-l);i<=Math.min(v,l);i+=2){let f;const C=c[i-1],p=c[i+1];C&&(c[i-1]=void 0);let x=!1;if(p){const E=p.oldPos-i;x=p&&0<=E&&E<d}const w=C&&C.oldPos+1<r;if(!x&&!w){c[i]=void 0;continue}if(!w||x&&C.oldPos<p.oldPos?f=this.addToPath(p,!0,!1,0,t):f=this.addToPath(C,!1,!0,1,t),m=this.extractCommon(f,n,e,i,t),f.oldPos+1>=r&&m+1>=d)return u(this.buildValues(f.lastComponent,n,e))||!0;c[i]=f,f.oldPos+1>=r&&(v=Math.min(v,i-1)),m+1>=d&&(g=Math.max(g,i+1))}l++};if(s)(function i(){setTimeout(function(){if(l>o||Date.now()>P)return s(void 0);L()||i()},0)})();else for(;l<=o&&Date.now()<=P;){const i=L();if(i)return i}}addToPath(e,n,t,s,a){const u=e.lastComponent;return u&&!a.oneChangePerToken&&u.added===n&&u.removed===t?{oldPos:e.oldPos+s,lastComponent:{count:u.count+1,added:n,removed:t,previousComponent:u.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:n,removed:t,previousComponent:u}}}extractCommon(e,n,t,s,a){const u=n.length,d=t.length;let r=e.oldPos,l=r-s,o=0;for(;l+1<u&&r+1<d&&this.equals(t[r+1],n[l+1],a);)l++,r++,o++,a.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return o&&!a.oneChangePerToken&&(e.lastComponent={count:o,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=r,l}equals(e,n,t){return t.comparator?t.comparator(e,n):e===n||!!t.ignoreCase&&e.toLowerCase()===n.toLowerCase()}removeEmpty(e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n}castInput(e,n){return e}tokenize(e,n){return Array.from(e)}join(e){return e.join("")}postProcess(e,n){return e}get useLongestToken(){return!1}buildValues(e,n,t){const s=[];let a;for(;e;)s.push(e),a=e.previousComponent,delete e.previousComponent,e=a;s.reverse();const u=s.length;let d=0,r=0,l=0;for(;d<u;d++){const o=s[d];if(o.removed)o.value=this.join(t.slice(l,l+o.count)),l+=o.count;else{if(!o.added&&this.useLongestToken){let h=n.slice(r,r+o.count);h=h.map(function(P,c){const m=t[l+c];return m.length>P.length?m:P}),o.value=this.join(h)}else o.value=this.join(n.slice(r,r+o.count));r+=o.count,o.added||(l+=o.count)}}return s}}export{D};
