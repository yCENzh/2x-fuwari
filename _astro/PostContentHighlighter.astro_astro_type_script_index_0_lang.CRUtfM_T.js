import{D as S}from"./base.CrPFMexR.js";function d(t,e){let n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function v(t,e){let n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function h(t,e,n){if(t.slice(0,e.length)!=e)throw Error(`string ${JSON.stringify(t)} doesn't start with prefix ${JSON.stringify(e)}; this is a bug`);return n+t.slice(e.length)}function m(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error(`string ${JSON.stringify(t)} doesn't end with suffix ${JSON.stringify(e)}; this is a bug`);return t.slice(0,-e.length)+n}function a(t,e){return h(t,e,"")}function g(t,e){return m(t,e,"")}function w(t,e){return e.slice(0,D(t,e))}function D(t,e){let n=0;t.length>e.length&&(n=t.length-e.length);let r=e.length;t.length<e.length&&(r=t.length);const l=Array(r);let s=0;l[0]=0;for(let o=1;o<r;o++){for(e[o]==e[s]?l[o]=l[s]:l[o]=s;s>0&&e[o]!=e[s];)s=l[s];e[o]==e[s]&&s++}s=0;for(let o=n;o<t.length;o++){for(;s>0&&t[o]!=e[s];)s=l[s];t[o]==e[s]&&s++}return s}function f(t){let e;for(e=t.length-1;e>=0&&t[e].match(/\s/);e--);return t.substring(e+1)}function i(t){const e=t.match(/^\s*/);return e?e[0]:""}const p="a-zA-Z0-9_\\u{AD}\\u{C0}-\\u{D6}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",k=new RegExp(`[${p}]+|\\s+|[^${p}]`,"ug");class P extends S{equals(e,n,r){return r.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e.trim()===n.trim()}tokenize(e,n={}){let r;if(n.intlSegmenter){const o=n.intlSegmenter;if(o.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');r=[];for(const c of Array.from(o.segment(e))){const u=c.segment;r.length&&/\s/.test(r[r.length-1])&&/\s/.test(u)?r[r.length-1]+=u:r.push(u)}}else r=e.match(k)||[];const l=[];let s=null;return r.forEach(o=>{/\s/.test(o)?s==null?l.push(o):l.push(l.pop()+o):s!=null&&/\s/.test(s)?l[l.length-1]==s?l.push(l.pop()+o):l.push(s+o):l.push(o),s=o}),l}join(e){return e.map((n,r)=>r==0?n:n.replace(/^\s+/,"")).join("")}postProcess(e,n){if(!e||n.oneChangePerToken)return e;let r=null,l=null,s=null;return e.forEach(o=>{o.added?l=o:o.removed?s=o:((l||s)&&x(r,s,l,o),r=o,l=null,s=null)}),(l||s)&&x(r,s,l,null),e}}const I=new P;function L(t,e,n){return I.diff(t,e,n)}function x(t,e,n,r){if(e&&n){const l=i(e.value),s=f(e.value),o=i(n.value),c=f(n.value);if(t){const u=d(l,o);t.value=m(t.value,o,u),e.value=a(e.value,u),n.value=a(n.value,u)}if(r){const u=v(s,c);r.value=h(r.value,c,u),e.value=g(e.value,u),n.value=g(n.value,u)}}else if(n){if(t){const l=i(n.value);n.value=n.value.substring(l.length)}if(r){const l=i(r.value);r.value=r.value.substring(l.length)}}else if(t&&r){const l=i(r.value),s=i(e.value),o=f(e.value),c=d(l,s);e.value=a(e.value,c);const u=v(a(l,c),o);e.value=g(e.value,u),r.value=h(r.value,l,u),t.value=m(t.value,l,l.slice(0,l.length-u.length))}else if(r){const l=i(r.value),s=f(e.value),o=w(s,l);e.value=g(e.value,o)}else if(t){const l=f(t.value),s=i(e.value),o=w(l,s);e.value=a(e.value,o)}}function T(){const t=document.querySelector(".markdown-content");return t&&t.textContent||""}const O="post-content-cache-";async function E(){if(!document.getElementById("post-container"))return;const e=window.location.pathname,n=O+e,r=T();if(new URLSearchParams(window.location.search).has("debug-diff")){console.log("[Diff] Developer mode active");const c=r.split(`

`),u=Math.floor(c.length/2),W=c.filter((N,y)=>y!==u).join(`

`);C(W,r);return}const o=localStorage.getItem(n);o?o!==r&&(console.log("[Diff] Content change detected"),C(o,r),localStorage.setItem(n,r)):localStorage.setItem(n,r)}function C(t,e){const n=L(t,e);if(!document.querySelector(".markdown-content"))return;const l=n.filter(o=>o.added&&o.value.trim().length>10);if(l.length===0)return;const s=document.getElementById("post-update-notification");s&&(s.classList.remove("translate-x-full","opacity-0","pointer-events-none"),document.getElementById("close-diff-toast")?.addEventListener("click",()=>{s.classList.add("translate-x-full","opacity-0","pointer-events-none")}),document.getElementById("scroll-to-diff")?.addEventListener("click",()=>{F(l[0].value)}))}function F(t){const e=document.querySelector(".markdown-content");if(!e)return;const n=t.trim().substring(0,50),r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let l;for(;l=r.nextNode();)if(l.textContent&&l.textContent.includes(n)){const s=document.createRange();s.selectNodeContents(l),s.getBoundingClientRect();const o=document.createElement("span");o.style.backgroundColor="rgba(255, 255, 0, 0.3)",o.style.transition="background-color 1s",o.className="diff-highlight-flash";const c=l.parentElement;c&&(c.scrollIntoView({behavior:"smooth",block:"center"}),c.classList.add("animate-pulse"),setTimeout(()=>c.classList.remove("animate-pulse"),2e3));return}}document.addEventListener("DOMContentLoaded",E);document.addEventListener("swup:contentReplaced",E);
